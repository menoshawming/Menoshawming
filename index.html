<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>MENO_shawming v1.3.0</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>MENO STORE | ULTIMATE PRO</title>

    <style>

        :root { --primary: #ff4b2b; --secondary: #8a2be2; --bg: #0d1117; --card: #161b22; --text: #fff; --accent: #238636; --gold: #fbbf24; }

        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 0; overflow-x: hidden; padding-bottom: 75px; user-select: none; }

        /* Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */

        #camera-container { position: fixed; top: 70px; right: 15px; width: 90px; height: 90px; border-radius: 50%; overflow: hidden; border: 2px solid var(--primary); z-index: 9999; background: #000; display: none; pointer-events: none; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }

        #webcam { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

        /* Ø´Ø§Ø´Ø© SOS */

        #sos-screen { display: none; position: fixed; inset: 0; background: white; color: #333; z-index: 99999; padding: 25px; overflow-y: auto; text-align: right; }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ */

        #auth-screen, #signup-screen { position: fixed; inset: 0; background: #090a0f; z-index: 1000; display: flex; align-items: center; justify-content: center; }

        .auth-box { background: var(--card); padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid #333; }

        /* Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */

        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; justify-content: space-around; padding: 10px; border-top: 1px solid #333; z-index: 1000; }

        .nav-item { color: #888; text-decoration: none; font-size: 12px; display: flex; flex-direction: column; align-items: center; cursor: pointer; flex: 1; transition: 0.3s; }

        .nav-item.active { color: var(--primary); }

        .page { display: none; min-height: 100vh; padding: 15px; box-sizing: border-box; }

        .page.active { display: block; }

        /* Ø§Ù„Ø´Ø§Øª */

        #chat-msgs { height: calc(100vh - 190px); overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth; }

        .msg { padding: 10px 15px; border-radius: 15px; background: #21262d; align-self: flex-start; max-width: 80%; font-size: 14px; word-wrap: break-word; text-align: right; border: 1px solid #333; }

        .msg-me { background: var(--accent); align-self: flex-end; border: none; }

        .msg-admin { background: linear-gradient(45deg, #161b22, #3a2a00); border: 1px solid var(--gold); }

        .navbar { background: var(--card); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 900; }

        .product-card { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #333; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--gold); }

        .welcome-banner { background: linear-gradient(45deg, #161b22, #2c0b05); padding: 20px; border-radius: 20px; border: 1px solid var(--primary); text-align: center; margin-bottom: 20px; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª */

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }

        .modal-content { background: var(--card); padding: 20px; border-radius: 20px; width: 100%; max-width: 450px; max-height: 80vh; overflow-y: auto; border: 1px solid #333; position: relative; }

        

        /* Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠØ© */

        .intro-step { display: none; text-align: center; animation: fadeIn 0.5s; }

        .intro-step.active { display: block; }

        .intro-icon { font-size: 50px; margin-bottom: 15px; display: block; }

        .intro-dots { display: flex; justify-content: center; gap: 5px; margin: 20px 0; }

        .dot { width: 8px; height: 8px; background: #444; border-radius: 50%; }

        .dot.active { background: var(--primary); width: 20px; border-radius: 10px; transition: 0.3s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-family: inherit; }

        .btn-buy { background: var(--primary); color: white; }

        .btn-open { background: var(--accent); color: white; }

        .btn-panic { position: fixed; bottom: 85px; left: 15px; width: 45px; height: 45px; border-radius: 50%; background: #300; border: 1px solid #600; color: #f00; z-index: 9999; cursor: pointer; }

        

        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; background: #000; color: #fff; border: 1px solid #444; border-radius: 8px; box-sizing: border-box; text-align: center; }

        iframe { width: 100%; height: 80vh; border-radius: 10px; border: none; background: white; }

        label { display: block; text-align: right; color: #aaa; font-size: 12px; margin-top: 5px; }

    </style>

</head>

<body oncontextmenu="return false;">

    <div id="camera-container"><video id="webcam" autoplay playsinline muted></video></div>

    <div id="sos-screen">

        <div style="max-width: 600px; margin: auto;">

            <span style="background: #e8f0fe; color: #1967d2; padding: 4px 12px; border-radius: 4px; font-size: 12px;">Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø§Ù„ÙˆØ²Ø§Ø±ÙŠØ©</span>

            <h1 id="sos-title">Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ø±Ù‚Ù…Ù†Ø© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…</h1>

            <div id="sos-body">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

            <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 12px;">

                <input type="text" id="sos-unlock" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©..." style="color: black; background: white; border: 1px solid #ddd;">

                <button onclick="checkUnlock()" style="width:100%; padding:15px; background:#1a73e8; color:white; border:none; border-radius: 8px;">Ø¨Ø­Ø«</button>

            </div>

        </div>

    </div>

    <div id="auth-screen">

        <div class="auth-box">

            <h1 style="color:var(--primary)">MENO STORE</h1>

            <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">

            <input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

            <button class="btn btn-buy" style="width:100%" onclick="handleAuth('login')">Ø¯Ø®ÙˆÙ„</button>

            <p onclick="showSignup()" style="color:#888; cursor:pointer; font-size:13px; margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¶ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</p>

        </div>

    </div>

    <div id="signup-screen" style="display:none">

        <div class="auth-box">

            <h1 style="color:var(--secondary)">Ø¹Ø¶ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h1>

            <input type="text" id="user-nick" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">

            <input type="text" id="user-sos" placeholder="ÙƒÙˆØ¯ SOS (Ù„Ù„ÙÙƒ)">

            <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">

            <input type="password" id="reg-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

            <button class="btn btn-open" style="width:100%" onclick="handleAuth('signup')">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>

            <p onclick="showLogin()" style="color:#888; cursor:pointer; font-size:13px; margin-top:15px;">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</p>

        </div>

    </div>

    <div id="main-ui" style="display:none">

        <div class="navbar">

            <div style="display:flex; gap:10px; align-items:center;">

                <button onclick="openSmartSettings()" style="background:none; border:none; font-size:24px; cursor:pointer;">âš™ï¸</button>

                <button onclick="startIntroTour()" style="background:none; border:none; font-size:20px; cursor:pointer;">â“</button>

            </div>

            <div id="u-bal" style="color:var(--accent); font-weight:bold; background:#000; padding:5px 12px; border-radius:12px; border:1px solid #222;">0.00 LE</div>

            <div style="font-weight:bold; color: var(--primary);">M_SHAWMING PRO</div>

        </div>

        <div id="store-page" class="page active">

            <div class="welcome-banner">

                <h3 id="welcome-msg" style="margin:0">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h3>

                <button class="btn btn-open" style="margin-top:10px;" onclick="openModal('deposit-modal')">Ø´Ø­Ù† Ø±ØµÙŠØ¯ ğŸ’°</button>

            </div>

            <div id="products-list">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯...</div>

        </div>

        <div id="chat-page" class="page" style="padding:0">

            <div id="chat-msgs"></div>

            <div style="padding:10px; display:flex; gap:8px; background:var(--card);">

                <input type="text" id="chat-in" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." style="margin:0; flex:1; text-align: right;">

                <button onclick="sendMsg()" class="btn btn-open">Ø¥Ø±Ø³Ø§Ù„</button>

            </div>

        </div>

        <div id="work-page" class="page">

            <div class="auth-box" style="width:100%; max-width:none; text-align: right;">

                <h2 style="color:var(--primary); text-align: center;">Ø§Ù†Ø¶Ù… Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ²Ø¹ÙŠÙ† ğŸ’¼</h2>

                <label>Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:</label>

                <input type="text" id="w-full-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">

                <label>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</label>

                <input type="tel" id="w-phone" placeholder="01xxxxxxxxx">

                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</label>

                <input type="text" id="w-school-name" placeholder="Ø§Ø³Ù… Ù…Ø¯Ø±Ø³ØªÙƒ">

                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø£Ùˆ Ø£Ù‚Ø±Ø¨ Ø´Ø§Ø±Ø¹ Ø±Ø¦ÙŠØ³ÙŠ:</label>

                <input type="text" id="w-address" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© - Ø§Ù„Ù…Ù†Ø·Ù‚Ø© - Ø§Ù„Ø´Ø§Ø±Ø¹">

                <label>Ø§Ø³Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©:</label>

                <input type="text" id="w-admin-zone" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…">

                <label>Ø§Ù„Ø³Ù† Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>

                <select id="w-grade">

                    <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>

                    <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯ÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯ÙŠ</option>

                    <option value="Ø§Ù„ØµÙ Ø§Ù„Ø§ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø§ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>

                    <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>

                    <option value="Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>

                    <option value="Ø§ÙƒØ¨Ø± Ù…Ù† Ø°Ù„Ùƒ">Ø§ÙƒØ¨Ø± Ù…Ù† Ø°Ù„Ùƒ</option>

                </select>

                <button class="btn btn-buy" style="width:100%; margin-top:15px;" onclick="submitWork()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>

            </div>

        </div>

        <div class="bottom-nav">

            <div class="nav-item active" onclick="switchPage('store-page', this)"><span>ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</span></div>

            <div class="nav-item" onclick="switchPage('chat-page', this)"><span>ğŸ’¬ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span></div>

            <div class="nav-item" onclick="switchPage('work-page', this)"><span>ğŸ’¼ Ø§Ù„Ø¹Ù…Ù„</span></div>

        </div>

    </div>

    <div id="intro-modal" class="modal">

        <div class="modal-content" style="max-width: 350px;">

            <div class="intro-step active" id="step-1">

                <span class="intro-icon">ğŸ‘‹</span>

                <h3 style="color:var(--primary)">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ MENO STORE</h3>

                <p style="font-size: 14px; color: #ccc;">Ù‡Ø°Ù‡ Ø¬ÙˆÙ„Ø© Ø³Ø±ÙŠØ¹Ø© Ù„ØªØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ù…ÙŠØ²Ø§Øª Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ULTIMATE PRO ÙˆÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§.</p>

                <div class="intro-dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>

                <button class="btn btn-buy" style="width:100%" onclick="nextStep(2)">Ø§Ù„ØªØ§Ù„ÙŠ</button>

            </div>

            <div class="intro-step" id="step-2">

                <span class="intro-icon">ğŸ›’</span>

                <h3 style="color:var(--gold)">Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø±ØµÙŠØ¯</h3>

                <p style="font-size: 14px; color: #ccc;">ÙŠÙ…ÙƒÙ†Ùƒ Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©. Ø§Ø´Ø­Ù† Ø±ØµÙŠØ¯Ùƒ Ø¹Ø¨Ø± WhatsApp Ù…Ù† Ø®Ù„Ø§Ù„ Ø²Ø± "Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯" ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>

                <div class="intro-dots"><div class="dot"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>

                <button class="btn btn-buy" style="width:100%" onclick="nextStep(3)">Ø§Ù„ØªØ§Ù„ÙŠ</button>

            </div>

            <div class="intro-step" id="step-3">

                <span class="intro-icon">ğŸš¨</span>

                <h3 style="color:#f00">ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ (SOS)</h3>

                <p style="font-size: 14px; color: #ccc;">Ø¨Ù…Ø¬Ø±Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± SOS Ø£Ùˆ Ù‚Ù„Ø¨ Ø§Ù„Ù‡Ø§ØªÙØŒ Ø³ØªØªØ­ÙˆÙ„ Ø§Ù„Ø´Ø§Ø´Ø© ÙÙˆØ±Ø§Ù‹ Ù„Ù…Ù‚Ø§Ù„ ØªØ¹Ù„ÙŠÙ…ÙŠ ÙˆÙ‡Ù…ÙŠ. Ù„ÙÙƒ Ø§Ù„Ù‚ÙÙ„ØŒ Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ SOS Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø«.</p>

                <div class="intro-dots"><div class="dot"></div><div class="dot"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>

                <button class="btn btn-buy" style="width:100%" onclick="nextStep(4)">Ø§Ù„ØªØ§Ù„ÙŠ</button>

            </div>

            <div class="intro-step" id="step-4">

                <span class="intro-icon">ğŸ“·</span>

                <h3 style="color:var(--accent)">Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©</h3>

                <p style="font-size: 14px; color: #ccc;">ØªØ¸Ù‡Ø± ÙƒØ§Ù…ÙŠØ±Ø§ ØµØºÙŠØ±Ø© Ø£Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ØªÙ…ÙƒÙ†Ùƒ Ù…Ù† Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø§ Ø­ÙˆÙ„Ùƒ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØºØ´ Ø¯ÙˆÙ† Ù„ÙØª Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ ÙˆØ§Ø°Ø§ Ø±Ø§Ø¦ÙŠØª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù‚Ù„Ø¨ Ø§Ù„Ù‡Ø§ØªÙ Ø¹Ù„ÙŠ ÙˆØ¬Ù‡Ù‡. ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>

                <div class="intro-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot active"></div><div class="dot"></div></div>

                <button class="btn btn-buy" style="width:100%" onclick="nextStep(5)">Ø§Ù„ØªØ§Ù„ÙŠ</button>

            </div>

            <div class="intro-step" id="step-5">

                <span class="intro-icon">ğŸš€</span>

                <h3 style="color:var(--secondary)">Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ø§Ù„Ø¢Ù†!</h3>

                <p style="font-size: 14px; color: #ccc;">Ø§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨Ø© ÙØ±ÙŠØ¯Ø© ÙˆØ¢Ù…Ù†Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø§Ø³ØªÙÙ‡Ø§Ù… (â“) Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰.</p>

                <div class="intro-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot active"></div></div>

                <button class="btn btn-open" style="width:100%" onclick="closeModal('intro-modal')">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</button>

            </div>

        </div>

    </div>

    <div id="admin-modal" class="modal">

        <div class="modal-content">

            <h2 style="color:var(--gold)">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>

            <input type="text" id="p-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©">

            <input type="number" id="p-price" placeholder="Ø§Ù„Ø³Ø¹Ø±">

            <input type="text" id="p-link" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù">

            <button class="btn btn-open" style="width:100%" onclick="adminAddProduct()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù„Ø¹Ø©</button>

            <hr>

            <input type="text" id="new-admin-uid" placeholder="UID Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯">

            <button class="btn btn-buy" style="width:100%" onclick="adminAddNewAdmin()">ØªØ¹ÙŠÙŠÙ† Ù…Ø´Ø±Ù</button>

            <hr>

            <input type="text" id="adm-target-uid" placeholder="UID Ø§Ù„Ø·Ø§Ù„Ø¨">

            <input type="number" id="adm-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">

            <button class="btn btn-open" style="width:100%" onclick="adminAddBalance()">Ø´Ø­Ù† Ø±ØµÙŠØ¯</button>

            <hr>

            <textarea id="adm-sos-content" placeholder="Ù…Ø­ØªÙˆÙ‰ Ù…Ù‚Ø§Ù„ SOS"></textarea>

            <button class="btn btn-buy" style="width:100%" onclick="adminUpdateSOS()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ù„</button>

            <button onclick="closeModal('admin-modal')" style="width:100%; margin-top:20px; background:#444; color:white; border:none; padding:10px;">Ø¥ØºÙ„Ø§Ù‚</button>

        </div>

    </div>

    <div id="settings-modal" class="modal">

        <div class="modal-content">

            <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>

            <input type="text" id="set-name" placeholder="Ø§Ù„Ø§Ø³Ù…">

            <input type="text" id="set-sos" placeholder="ÙƒÙˆØ¯ SOS">

            <button class="btn btn-open" style="width:100%" onclick="updateProfile()">Ø­ÙØ¸</button>

            <button onclick="closeModal('settings-modal')" style="width:100%; margin-top:10px; background:none; color:white; border:none;">Ø¥ØºÙ„Ø§Ù‚</button>

        </div>

    </div>

    <div id="deposit-modal" class="modal">

        <div class="modal-content">

            <h3>Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h3>

            <input type="number" id="dep-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">

            <button class="btn btn-open" style="width:100%" onclick="redirectToWhatsApp()">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>

            <button onclick="closeModal('deposit-modal')" style="width:100%; margin-top:10px; background:none; color:white; border:none;">Ø¥Ù„ØºØ§Ø¡</button>

        </div>

    </div>

    <div id="viewer-modal" class="modal">

        <div class="modal-content" style="max-width:98%; height:95vh;">

            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">

                <b id="viewer-title" style="color:var(--gold)">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù…Ù†</b>

                <button onclick="closeModal('viewer-modal')" style="background:red; color:white; border:none; border-radius:5px;">Ø¥ØºÙ„Ø§Ù‚ X</button>

            </div>

            <iframe id="secure-iframe"></iframe>

        </div>

    </div>

    <button class="btn-panic" onclick="activateSOS()">SOS</button>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";

        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

        import { getDatabase, ref, set, get, update, increment, onValue, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        const firebaseConfig = {

            apiKey: "AIzaSyBgd5MkjrAOTtt-hhmuGVCh26klzEMB1ag",

            authDomain: "menoshawming-cb8a2.firebaseapp.com",

            databaseURL: "https://menoshawming-cb8a2-default-rtdb.firebaseio.com",

            projectId: "menoshawming-cb8a2",

            appId: "1:558599729266:web:f8a7799809ebf92eb292eb"

        };

        const app = initializeApp(firebaseConfig);

        const auth = getAuth(app);

        const db = getDatabase(app);

        let userLocal = null;

        let adminList = ["kLw4Ocx1JsOHAL04rQc6ZkO7qnf2"]; 

        onValue(ref(db, 'admins'), (s) => { if(s.exists()) adminList = [...Object.values(s.val()), "kLw4Ocx1JsOHAL04rQc6ZkO7qnf2"]; });

        onAuthStateChanged(auth, (user) => {

            if (user) {

                document.getElementById('auth-screen').style.display = 'none';

                document.getElementById('signup-screen').style.display = 'none';

                document.getElementById('main-ui').style.display = 'block';

                startCamera();

                onValue(ref(db, 'users/' + user.uid), (s) => {

                    userLocal = s.val();

                    if(userLocal) {

                        document.getElementById('u-bal').innerText = (userLocal.balance || 0).toFixed(2) + " LE";

                        document.getElementById('welcome-msg').innerText = "ÙŠØ§ Ù…Ø±Ø­Ø¨ØŒ " + userLocal.name;

                        

                        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¬ÙˆÙ„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯

                        if(!localStorage.getItem('tour_done_' + user.uid)) {

                            startIntroTour();

                            localStorage.setItem('tour_done_' + user.uid, 'true');

                        }

                    }

                });

                loadChat();

                loadItems();

                loadSOSArticle();

            } else {

                document.getElementById('auth-screen').style.display = 'flex';

                document.getElementById('main-ui').style.display = 'none';

                stopCamera();

            }

        });

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠØ©

        window.startIntroTour = () => {

            nextStep(1);

            openModal('intro-modal');

        };

        window.nextStep = (num) => {

            document.querySelectorAll('.intro-step').forEach(s => s.classList.remove('active'));

            document.getElementById('step-' + num).classList.add('active');

        };

        window.sendMsg = async () => {

            const input = document.getElementById('chat-in');

            const val = input.value.trim();

            if(!val || !auth.currentUser) return;

            let senderName = "Ù…Ø³ØªØ®Ø¯Ù…";

            if(userLocal && userLocal.name) {

                senderName = userLocal.name;

            } else {

                const snapshot = await get(ref(db, 'users/' + auth.currentUser.uid));

                if(snapshot.exists()) senderName = snapshot.val().name;

            }

            try {

                await push(ref(db, 'chat'), { 

                    name: senderName, 

                    text: val, 

                    uid: auth.currentUser.uid,

                    time: serverTimestamp()

                });

                input.value = "";

            } catch(e) { alert("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!"); }

        };

        window.loadChat = () => {

            onValue(ref(db, 'chat'), (snap) => {

                let h = '';

                snap.forEach(c => {

                    const m = c.val();

                    const isAdmin = adminList.includes(m.uid);

                    const isMe = auth.currentUser && m.uid === auth.currentUser.uid;

                    h += `<div class="msg ${isMe ? 'msg-me' : ''} ${isAdmin ? 'msg-admin' : ''}">

                            <b style="${isAdmin ? 'color:gold' : ''}">${isAdmin ? 'ğŸ‘‘ ' : ''}${m.name}:</b> ${m.text}

                          </div>`;

                });

                const b = document.getElementById('chat-msgs');

                b.innerHTML = h;

                b.scrollTop = b.scrollHeight;

            });

        };

        window.loadItems = () => {

            onValue(ref(db, 'products'), (snap) => {

                let h = '';

                const bought = userLocal?.purchased || [];

                snap.forEach(child => {

                    const p = child.val();

                    const isOwned = bought.includes(child.key) || p.price === 0 || (auth.currentUser && adminList.includes(auth.currentUser.uid));

                    h += `<div class="product-card">

                        <div><b>${p.name}</b><br><small style="color:var(--gold)">${isOwned ? 'Ù…ØªØ§Ø­ âœ…' : p.price + ' LE'}</small></div>

                        ${isOwned ? `<button class="btn btn-open" onclick="openItem('${p.name}', '${p.link}')">ÙØªØ­</button>` 

                        : `<button class="btn btn-buy" onclick="buyItem('${child.key}', ${p.price})">Ø´Ø±Ø§Ø¡</button>`}

                    </div>`;

                });

                document.getElementById('products-list').innerHTML = h;

            });

        };

        window.buyItem = async (id, price) => {

            if(userLocal.balance >= price) {

                const p = userLocal.purchased || []; p.push(id);

                await update(ref(db, 'users/'+auth.currentUser.uid), { balance: increment(-price), purchased: p });

                alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ âœ…");

            } else alert("Ø±ØµÙŠØ¯Ùƒ Ù„Ø§ ÙŠÙƒÙÙŠ");

        };

        window.openItem = (title, url) => {

            document.getElementById('viewer-title').innerText = title;

            let finalUrl = url.includes('google.com') ? url.replace("/view?usp=sharing", "/preview") : url;

            document.getElementById('secure-iframe').src = finalUrl;

            openModal('viewer-modal');

        };

        window.submitWork = async () => {

            const name = document.getElementById('w-full-name').value;

            const phone = document.getElementById('w-phone').value;

            const school = document.getElementById('w-school-name').value;

            const addr = document.getElementById('w-address').value;

            const zone = document.getElementById('w-admin-zone').value;

            const grade = document.getElementById('w-grade').value;

            if(!name || !phone || !school || !addr || !zone || !grade) { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }

            await push(ref(db, 'work_requests'), { name, phone, school, addr, zone, grade, uid: auth.currentUser.uid });

            alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…");

        };

        window.adminAddProduct = async () => {

            const name = document.getElementById('p-name').value;

            const price = parseFloat(document.getElementById('p-price').value);

            const link = document.getElementById('p-link').value;

            if(name && link) { await push(ref(db, 'products'), { name, price, link }); alert("ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©"); }

        };

        window.adminAddNewAdmin = async () => {

            const newUid = document.getElementById('new-admin-uid').value;

            if(newUid) { await push(ref(db, 'admins'), newUid); alert("ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†"); }

        };

        window.adminAddBalance = async () => {

            const t = document.getElementById('adm-target-uid').value;

            const a = parseFloat(document.getElementById('adm-amount').value);

            await update(ref(db, 'users/'+t), { balance: increment(a) }); alert("ØªÙ… Ø§Ù„Ø´Ø­Ù†");

        };

        window.adminUpdateSOS = async () => {

            const c = document.getElementById('adm-sos-content').value;

            await set(ref(db, 'settings/sos_article'), { content: c }); alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");

        };

        window.activateSOS = () => {

            document.getElementById('main-ui').style.display = 'none';

            document.getElementById('sos-screen').style.display = 'block';

            document.getElementById('camera-container').style.display = 'none';

        };

        window.checkUnlock = () => {

            if(document.getElementById('sos-unlock').value === userLocal.sosCode) {

                document.getElementById('sos-screen').style.display = 'none';

                document.getElementById('main-ui').style.display = 'block';

                startCamera();

            } else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø±Ø¬Ø¹");

        };

        window.addEventListener('deviceorientation', (e) => { if (e.beta > 160 || e.beta < -160) activateSOS(); });

        async function startCamera() {

            try {

                const s = await navigator.mediaDevices.getUserMedia({ video: true });

                document.getElementById('webcam').srcObject = s;

                document.getElementById('camera-container').style.display = 'block';

            } catch(e){}

        }

        function stopCamera() { 

            let s = document.getElementById('webcam').srcObject;

            if(s) s.getTracks().forEach(t => t.stop());

            document.getElementById('camera-container').style.display = 'none';

        }

        window.switchPage = (p, el) => {

            document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));

            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));

            document.getElementById(p).classList.add('active');

            el.classList.add('active');

            if(p === 'chat-page') {

                const b = document.getElementById('chat-msgs');

                setTimeout(() => { b.scrollTop = b.scrollHeight; }, 100);

            }

        };

        window.handleAuth = async (t) => {

            const e = document.getElementById(t==='login'?'login-email':'reg-email').value;

            const p = document.getElementById(t==='login'?'login-pass':'reg-pass').value;

            try {

                if(t==='signup') {

                    const r = await createUserWithEmailAndPassword(auth, e, p);

                    await set(ref(db, 'users/'+r.user.uid), { 

                        name: document.getElementById('user-nick').value, 

                        sosCode: document.getElementById('user-sos').value, 

                        balance: 0 

                    });

                } else await signInWithEmailAndPassword(auth, e, p);

            } catch(err) { alert(err.message); }

        };

        window.openSmartSettings = () => {

            if(auth.currentUser && adminList.includes(auth.currentUser.uid)) openModal('admin-modal');

            else openModal('settings-modal');

        };

        window.openModal = (id) => document.getElementById(id).style.display = 'flex';

        window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; if(id==='viewer-modal') document.getElementById('secure-iframe').src=''; };

        function loadSOSArticle() { onValue(ref(db, 'settings/sos_article'), (s) => { if(s.exists()) document.getElementById('sos-body').innerText = s.val().content; }); }

        window.showSignup = () => { document.getElementById('auth-screen').style.display='none'; document.getElementById('signup-screen').style.display='flex'; };

        window.showLogin = () => { document.getElementById('auth-screen').style.display='flex'; document.getElementById('signup-screen').style.display='none'; };

        window.updateProfile = async () => {

            await update(ref(db, 'users/'+auth.currentUser.uid), { name: document.getElementById('set-name').value, sosCode: document.getElementById('set-sos').value });

            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");

        };

        window.redirectToWhatsApp = () => {

            const a = document.getElementById('dep-amount').value;

            window.open(`https://wa.me/201200756998?text=Ø´Ø­Ù†:${a}

            

            

            -ID:${auth.currentUser.uid}`);

        };

    </script>

</body>

</html>
    
  </body>
  
</html>
